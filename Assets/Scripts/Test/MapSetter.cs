using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class MapSetter : MonoBehaviour
{
    private MazeMap map;
    [SerializeField] List<MazeTile> tileList = new List<MazeTile>();
    [SerializeField] Pathfinding pathfinding;
    private TypeToTileConverter converter;
    private List<MazeBot> bots = new List<MazeBot>();
    string mapJson = "{\"Items\":[{\"type\":0,\"x\":0,\"y\":0},{\"type\":0,\"x\":0,\"y\":1},{\"type\":0,\"x\":0,\"y\":2},{\"type\":0,\"x\":0,\"y\":3},{\"type\":0,\"x\":0,\"y\":4},{\"type\":0,\"x\":0,\"y\":5},{\"type\":0,\"x\":0,\"y\":6},{\"type\":0,\"x\":0,\"y\":7},{\"type\":0,\"x\":0,\"y\":8},{\"type\":0,\"x\":0,\"y\":9},{\"type\":0,\"x\":0,\"y\":10},{\"type\":0,\"x\":0,\"y\":11},{\"type\":0,\"x\":0,\"y\":12},{\"type\":0,\"x\":0,\"y\":13},{\"type\":0,\"x\":0,\"y\":14},{\"type\":0,\"x\":1,\"y\":0},{\"type\":0,\"x\":1,\"y\":1},{\"type\":0,\"x\":1,\"y\":2},{\"type\":0,\"x\":1,\"y\":3},{\"type\":0,\"x\":1,\"y\":4},{\"type\":0,\"x\":1,\"y\":5},{\"type\":0,\"x\":1,\"y\":6},{\"type\":0,\"x\":1,\"y\":7},{\"type\":0,\"x\":1,\"y\":8},{\"type\":0,\"x\":1,\"y\":9},{\"type\":0,\"x\":1,\"y\":10},{\"type\":0,\"x\":1,\"y\":11},{\"type\":0,\"x\":1,\"y\":12},{\"type\":0,\"x\":1,\"y\":13},{\"type\":0,\"x\":1,\"y\":14},{\"type\":0,\"x\":2,\"y\":0},{\"type\":0,\"x\":2,\"y\":1},{\"type\":0,\"x\":2,\"y\":2},{\"type\":0,\"x\":2,\"y\":3},{\"type\":0,\"x\":2,\"y\":4},{\"type\":0,\"x\":2,\"y\":5},{\"type\":0,\"x\":2,\"y\":6},{\"type\":0,\"x\":2,\"y\":7},{\"type\":0,\"x\":2,\"y\":8},{\"type\":0,\"x\":2,\"y\":9},{\"type\":0,\"x\":2,\"y\":10},{\"type\":0,\"x\":2,\"y\":11},{\"type\":0,\"x\":2,\"y\":12},{\"type\":0,\"x\":2,\"y\":13},{\"type\":0,\"x\":2,\"y\":14},{\"type\":0,\"x\":3,\"y\":0},{\"type\":0,\"x\":3,\"y\":1},{\"type\":0,\"x\":3,\"y\":2},{\"type\":0,\"x\":3,\"y\":3},{\"type\":0,\"x\":3,\"y\":4},{\"type\":0,\"x\":3,\"y\":5},{\"type\":0,\"x\":3,\"y\":6},{\"type\":0,\"x\":3,\"y\":7},{\"type\":0,\"x\":3,\"y\":8},{\"type\":0,\"x\":3,\"y\":9},{\"type\":0,\"x\":3,\"y\":10},{\"type\":0,\"x\":3,\"y\":11},{\"type\":0,\"x\":3,\"y\":12},{\"type\":0,\"x\":3,\"y\":13},{\"type\":0,\"x\":3,\"y\":14},{\"type\":0,\"x\":4,\"y\":0},{\"type\":0,\"x\":4,\"y\":1},{\"type\":0,\"x\":4,\"y\":2},{\"type\":0,\"x\":4,\"y\":3},{\"type\":0,\"x\":4,\"y\":4},{\"type\":0,\"x\":4,\"y\":5},{\"type\":0,\"x\":4,\"y\":6},{\"type\":0,\"x\":4,\"y\":7},{\"type\":0,\"x\":4,\"y\":8},{\"type\":0,\"x\":4,\"y\":9},{\"type\":0,\"x\":4,\"y\":10},{\"type\":0,\"x\":4,\"y\":11},{\"type\":0,\"x\":4,\"y\":12},{\"type\":0,\"x\":4,\"y\":13},{\"type\":0,\"x\":4,\"y\":14},{\"type\":1,\"x\":5,\"y\":0},{\"type\":1,\"x\":5,\"y\":1},{\"type\":1,\"x\":5,\"y\":2},{\"type\":1,\"x\":5,\"y\":3},{\"type\":1,\"x\":5,\"y\":4},{\"type\":1,\"x\":5,\"y\":5},{\"type\":1,\"x\":5,\"y\":6},{\"type\":1,\"x\":5,\"y\":7},{\"type\":0,\"x\":5,\"y\":8},{\"type\":0,\"x\":5,\"y\":9},{\"type\":0,\"x\":5,\"y\":10},{\"type\":0,\"x\":5,\"y\":11},{\"type\":0,\"x\":5,\"y\":12},{\"type\":0,\"x\":5,\"y\":13},{\"type\":0,\"x\":5,\"y\":14},{\"type\":1,\"x\":6,\"y\":0},{\"type\":1,\"x\":6,\"y\":1},{\"type\":1,\"x\":6,\"y\":2},{\"type\":1,\"x\":6,\"y\":3},{\"type\":2,\"x\":6,\"y\":4},{\"type\":1,\"x\":6,\"y\":5},{\"type\":1,\"x\":6,\"y\":6},{\"type\":1,\"x\":6,\"y\":7},{\"type\":0,\"x\":6,\"y\":8},{\"type\":0,\"x\":6,\"y\":9},{\"type\":0,\"x\":6,\"y\":10},{\"type\":0,\"x\":6,\"y\":11},{\"type\":0,\"x\":6,\"y\":12},{\"type\":0,\"x\":6,\"y\":13},{\"type\":0,\"x\":6,\"y\":14},{\"type\":1,\"x\":7,\"y\":0},{\"type\":1,\"x\":7,\"y\":1},{\"type\":1,\"x\":7,\"y\":2},{\"type\":1,\"x\":7,\"y\":3},{\"type\":1,\"x\":7,\"y\":4},{\"type\":1,\"x\":7,\"y\":5},{\"type\":1,\"x\":7,\"y\":6},{\"type\":1,\"x\":7,\"y\":7},{\"type\":0,\"x\":7,\"y\":8},{\"type\":0,\"x\":7,\"y\":9},{\"type\":0,\"x\":7,\"y\":10},{\"type\":0,\"x\":7,\"y\":11},{\"type\":0,\"x\":7,\"y\":12},{\"type\":0,\"x\":7,\"y\":13},{\"type\":0,\"x\":7,\"y\":14},{\"type\":1,\"x\":8,\"y\":0},{\"type\":2,\"x\":8,\"y\":1},{\"type\":2,\"x\":8,\"y\":2},{\"type\":2,\"x\":8,\"y\":3},{\"type\":2,\"x\":8,\"y\":4},{\"type\":2,\"x\":8,\"y\":5},{\"type\":2,\"x\":8,\"y\":6},{\"type\":1,\"x\":8,\"y\":7},{\"type\":0,\"x\":8,\"y\":8},{\"type\":0,\"x\":8,\"y\":9},{\"type\":0,\"x\":8,\"y\":10},{\"type\":0,\"x\":8,\"y\":11},{\"type\":0,\"x\":8,\"y\":12},{\"type\":0,\"x\":8,\"y\":13},{\"type\":0,\"x\":8,\"y\":14},{\"type\":1,\"x\":9,\"y\":0},{\"type\":1,\"x\":9,\"y\":1},{\"type\":2,\"x\":9,\"y\":2},{\"type\":1,\"x\":9,\"y\":3},{\"type\":2,\"x\":9,\"y\":4},{\"type\":1,\"x\":9,\"y\":5},{\"type\":1,\"x\":9,\"y\":6},{\"type\":1,\"x\":9,\"y\":7},{\"type\":0,\"x\":9,\"y\":8},{\"type\":0,\"x\":9,\"y\":9},{\"type\":0,\"x\":9,\"y\":10},{\"type\":0,\"x\":9,\"y\":11},{\"type\":0,\"x\":9,\"y\":12},{\"type\":0,\"x\":9,\"y\":13},{\"type\":0,\"x\":9,\"y\":14},{\"type\":1,\"x\":10,\"y\":0},{\"type\":1,\"x\":10,\"y\":1},{\"type\":2,\"x\":10,\"y\":2},{\"type\":2,\"x\":10,\"y\":3},{\"type\":2,\"x\":10,\"y\":4},{\"type\":1,\"x\":10,\"y\":5},{\"type\":1,\"x\":10,\"y\":6},{\"type\":1,\"x\":10,\"y\":7},{\"type\":0,\"x\":10,\"y\":8},{\"type\":0,\"x\":10,\"y\":9},{\"type\":0,\"x\":10,\"y\":10},{\"type\":0,\"x\":10,\"y\":11},{\"type\":0,\"x\":10,\"y\":12},{\"type\":0,\"x\":10,\"y\":13},{\"type\":0,\"x\":10,\"y\":14},{\"type\":5,\"x\":11,\"y\":0},{\"type\":1,\"x\":11,\"y\":1},{\"type\":1,\"x\":11,\"y\":2},{\"type\":1,\"x\":11,\"y\":3},{\"type\":1,\"x\":11,\"y\":4},{\"type\":1,\"x\":11,\"y\":5},{\"type\":1,\"x\":11,\"y\":6},{\"type\":1,\"x\":11,\"y\":7},{\"type\":0,\"x\":11,\"y\":8},{\"type\":0,\"x\":11,\"y\":9},{\"type\":0,\"x\":11,\"y\":10},{\"type\":0,\"x\":11,\"y\":11},{\"type\":0,\"x\":11,\"y\":12},{\"type\":0,\"x\":11,\"y\":13},{\"type\":0,\"x\":11,\"y\":14},{\"type\":1,\"x\":12,\"y\":0},{\"type\":1,\"x\":12,\"y\":1},{\"type\":1,\"x\":12,\"y\":2},{\"type\":1,\"x\":12,\"y\":3},{\"type\":1,\"x\":12,\"y\":4},{\"type\":1,\"x\":12,\"y\":5},{\"type\":1,\"x\":12,\"y\":6},{\"type\":1,\"x\":12,\"y\":7},{\"type\":0,\"x\":12,\"y\":8},{\"type\":0,\"x\":12,\"y\":9},{\"type\":0,\"x\":12,\"y\":10},{\"type\":0,\"x\":12,\"y\":11},{\"type\":0,\"x\":12,\"y\":12},{\"type\":0,\"x\":12,\"y\":13},{\"type\":0,\"x\":12,\"y\":14},{\"type\":1,\"x\":13,\"y\":0},{\"type\":1,\"x\":13,\"y\":1},{\"type\":1,\"x\":13,\"y\":2},{\"type\":2,\"x\":13,\"y\":3},{\"type\":2,\"x\":13,\"y\":4},{\"type\":2,\"x\":13,\"y\":5},{\"type\":1,\"x\":13,\"y\":6},{\"type\":1,\"x\":13,\"y\":7},{\"type\":0,\"x\":13,\"y\":8},{\"type\":0,\"x\":13,\"y\":9},{\"type\":0,\"x\":13,\"y\":10},{\"type\":0,\"x\":13,\"y\":11},{\"type\":0,\"x\":13,\"y\":12},{\"type\":0,\"x\":13,\"y\":13},{\"type\":0,\"x\":13,\"y\":14},{\"type\":1,\"x\":14,\"y\":0},{\"type\":1,\"x\":14,\"y\":1},{\"type\":1,\"x\":14,\"y\":2},{\"type\":2,\"x\":14,\"y\":3},{\"type\":1,\"x\":14,\"y\":4},{\"type\":2,\"x\":14,\"y\":5},{\"type\":1,\"x\":14,\"y\":6},{\"type\":1,\"x\":14,\"y\":7},{\"type\":0,\"x\":14,\"y\":8},{\"type\":0,\"x\":14,\"y\":9},{\"type\":0,\"x\":14,\"y\":10},{\"type\":0,\"x\":14,\"y\":11},{\"type\":0,\"x\":14,\"y\":12},{\"type\":0,\"x\":14,\"y\":13},{\"type\":0,\"x\":14,\"y\":14},{\"type\":1,\"x\":15,\"y\":0},{\"type\":2,\"x\":15,\"y\":1},{\"type\":2,\"x\":15,\"y\":2},{\"type\":2,\"x\":15,\"y\":3},{\"type\":2,\"x\":15,\"y\":4},{\"type\":2,\"x\":15,\"y\":5},{\"type\":2,\"x\":15,\"y\":6},{\"type\":1,\"x\":15,\"y\":7},{\"type\":0,\"x\":15,\"y\":8},{\"type\":0,\"x\":15,\"y\":9},{\"type\":0,\"x\":15,\"y\":10},{\"type\":0,\"x\":15,\"y\":11},{\"type\":0,\"x\":15,\"y\":12},{\"type\":0,\"x\":15,\"y\":13},{\"type\":0,\"x\":15,\"y\":14},{\"type\":1,\"x\":16,\"y\":0},{\"type\":1,\"x\":16,\"y\":1},{\"type\":1,\"x\":16,\"y\":2},{\"type\":1,\"x\":16,\"y\":3},{\"type\":1,\"x\":16,\"y\":4},{\"type\":1,\"x\":16,\"y\":5},{\"type\":1,\"x\":16,\"y\":6},{\"type\":1,\"x\":16,\"y\":7},{\"type\":0,\"x\":16,\"y\":8},{\"type\":0,\"x\":16,\"y\":9},{\"type\":0,\"x\":16,\"y\":10},{\"type\":0,\"x\":16,\"y\":11},{\"type\":0,\"x\":16,\"y\":12},{\"type\":0,\"x\":16,\"y\":13},{\"type\":0,\"x\":16,\"y\":14},{\"type\":1,\"x\":17,\"y\":0},{\"type\":1,\"x\":17,\"y\":1},{\"type\":1,\"x\":17,\"y\":2},{\"type\":2,\"x\":17,\"y\":3},{\"type\":1,\"x\":17,\"y\":4},{\"type\":1,\"x\":17,\"y\":5},{\"type\":1,\"x\":17,\"y\":6},{\"type\":1,\"x\":17,\"y\":7},{\"type\":0,\"x\":17,\"y\":8},{\"type\":0,\"x\":17,\"y\":9},{\"type\":0,\"x\":17,\"y\":10},{\"type\":0,\"x\":17,\"y\":11},{\"type\":0,\"x\":17,\"y\":12},{\"type\":0,\"x\":17,\"y\":13},{\"type\":0,\"x\":17,\"y\":14},{\"type\":1,\"x\":18,\"y\":0},{\"type\":1,\"x\":18,\"y\":1},{\"type\":1,\"x\":18,\"y\":2},{\"type\":1,\"x\":18,\"y\":3},{\"type\":1,\"x\":18,\"y\":4},{\"type\":1,\"x\":18,\"y\":5},{\"type\":1,\"x\":18,\"y\":6},{\"type\":1,\"x\":18,\"y\":7},{\"type\":0,\"x\":18,\"y\":8},{\"type\":0,\"x\":18,\"y\":9},{\"type\":0,\"x\":18,\"y\":10},{\"type\":0,\"x\":18,\"y\":11},{\"type\":0,\"x\":18,\"y\":12},{\"type\":0,\"x\":18,\"y\":13},{\"type\":0,\"x\":18,\"y\":14},{\"type\":0,\"x\":19,\"y\":0},{\"type\":0,\"x\":19,\"y\":1},{\"type\":0,\"x\":19,\"y\":2},{\"type\":0,\"x\":19,\"y\":3},{\"type\":0,\"x\":19,\"y\":4},{\"type\":0,\"x\":19,\"y\":5},{\"type\":0,\"x\":19,\"y\":6},{\"type\":0,\"x\":19,\"y\":7},{\"type\":0,\"x\":19,\"y\":8},{\"type\":0,\"x\":19,\"y\":9},{\"type\":0,\"x\":19,\"y\":10},{\"type\":0,\"x\":19,\"y\":11},{\"type\":0,\"x\":19,\"y\":12},{\"type\":0,\"x\":19,\"y\":13},{\"type\":0,\"x\":19,\"y\":14},{\"type\":0,\"x\":20,\"y\":0},{\"type\":0,\"x\":20,\"y\":1},{\"type\":0,\"x\":20,\"y\":2},{\"type\":0,\"x\":20,\"y\":3},{\"type\":0,\"x\":20,\"y\":4},{\"type\":0,\"x\":20,\"y\":5},{\"type\":0,\"x\":20,\"y\":6},{\"type\":0,\"x\":20,\"y\":7},{\"type\":0,\"x\":20,\"y\":8},{\"type\":0,\"x\":20,\"y\":9},{\"type\":0,\"x\":20,\"y\":10},{\"type\":0,\"x\":20,\"y\":11},{\"type\":0,\"x\":20,\"y\":12},{\"type\":0,\"x\":20,\"y\":13},{\"type\":0,\"x\":20,\"y\":14},{\"type\":0,\"x\":21,\"y\":0},{\"type\":0,\"x\":21,\"y\":1},{\"type\":0,\"x\":21,\"y\":2},{\"type\":0,\"x\":21,\"y\":3},{\"type\":0,\"x\":21,\"y\":4},{\"type\":0,\"x\":21,\"y\":5},{\"type\":0,\"x\":21,\"y\":6},{\"type\":0,\"x\":21,\"y\":7},{\"type\":0,\"x\":21,\"y\":8},{\"type\":0,\"x\":21,\"y\":9},{\"type\":0,\"x\":21,\"y\":10},{\"type\":0,\"x\":21,\"y\":11},{\"type\":0,\"x\":21,\"y\":12},{\"type\":0,\"x\":21,\"y\":13},{\"type\":0,\"x\":21,\"y\":14},{\"type\":0,\"x\":22,\"y\":0},{\"type\":0,\"x\":22,\"y\":1},{\"type\":0,\"x\":22,\"y\":2},{\"type\":0,\"x\":22,\"y\":3},{\"type\":0,\"x\":22,\"y\":4},{\"type\":0,\"x\":22,\"y\":5},{\"type\":0,\"x\":22,\"y\":6},{\"type\":0,\"x\":22,\"y\":7},{\"type\":0,\"x\":22,\"y\":8},{\"type\":0,\"x\":22,\"y\":9},{\"type\":0,\"x\":22,\"y\":10},{\"type\":0,\"x\":22,\"y\":11},{\"type\":0,\"x\":22,\"y\":12},{\"type\":0,\"x\":22,\"y\":13},{\"type\":0,\"x\":22,\"y\":14},{\"type\":0,\"x\":23,\"y\":0},{\"type\":0,\"x\":23,\"y\":1},{\"type\":0,\"x\":23,\"y\":2},{\"type\":0,\"x\":23,\"y\":3},{\"type\":0,\"x\":23,\"y\":4},{\"type\":0,\"x\":23,\"y\":5},{\"type\":0,\"x\":23,\"y\":6},{\"type\":0,\"x\":23,\"y\":7},{\"type\":0,\"x\":23,\"y\":8},{\"type\":0,\"x\":23,\"y\":9},{\"type\":0,\"x\":23,\"y\":10},{\"type\":0,\"x\":23,\"y\":11},{\"type\":0,\"x\":23,\"y\":12},{\"type\":0,\"x\":23,\"y\":13},{\"type\":0,\"x\":23,\"y\":14}]}";

    public List<MazeBot> Bots { get => bots; set => bots = value; }
    public MazeMap Map { get => map; set => map = value; }

    private void Awake()
    {
        this.converter = TypeToTileConverter.GetInstance();
        converter.SetArray(tileList.ToArray());
        map = new MazeMap(6, 12, 0.5f, tileList[0], MazeModes.Bet);

    }

    private void Start()
    {
        map.LoadFromAPI(mapJson);
        CreateBot();
    }

    internal void SetBots(List<MazeBot> deadBots)
    {
        foreach (MazeBot bot in deadBots)
            bots.Remove(bot);
    }

    public void CreateBot()
    {
        Vector2[] corresp = new Vector2[8];
        corresp[0] = new Vector2( 1, 0);
        corresp[1] = new Vector2( 2, 0);
        corresp[2] = new Vector2( 3, 0);
        corresp[3] = new Vector2( 4, 0);
        corresp[4] = new Vector2( 1, 11);
        corresp[5] = new Vector2( 2, 11);
        corresp[6] = new Vector2( 3, 11);
        corresp[7] = new Vector2( 4, 11);

        Debug.Log("MazeBet, CreateBot : start");
        pathfinding = new Pathfinding(map.GetGrid());

        for (int i = 0; i < 8; i++)
        {
            var team = "";
            if (i < 4) team = "blue";
            else team = "red";
            GameObject gameObject = new GameObject("bot_" + team +"_"+ i, typeof(BotBank));
            var bot = gameObject.GetComponent<BotBank>();
            
            bot.SetGrid(map.GetGrid());
            bot.Initialize((int)corresp[i].x, (int)corresp[i].y);

            var col = gameObject.AddComponent<BoxCollider2D>();
            col.isTrigger = true;
            col.size = new Vector2(0.04f, 0.04f);



            if (i < 4) bot.SetColor(Color.blue);
            else { bot.SetColor(Color.red); bot.Team = 1; };

            bots.Add(gameObject.GetComponent<BotBank>());
        }
    }

    public List<MazeTile> CheckPathfinding(MazeTile startTile, MazeTile endTile)
    {
        return pathfinding.FindPath(startTile.GetXPos(), startTile.GetYPos(), endTile.GetXPos(), endTile.GetYPos());
    }

    public MazeBot CheckBotOnATile(MazeTile tile)
    {
        foreach(MazeBot bot in bots)
        {
            if (bot.CurrentTile == tile) return bot;
        }
        return null;
    }
    public MazeBot CheckBotOnATile(int x, int y)
    {
        foreach (MazeBot bot in bots)
        {
            if (bot.CurrentTile.GetXPos() == x && bot.CurrentTile.GetXPos() == y) return bot;
        }
        return null;
    }

}
